---
title: "Copying answers"
output: rmarkdown::html_vignette
description: >
  Learn how to copy answers between reviews and avoid redundant work.
vignette: >
  %\VignetteIndexEntry{Copying answers}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, setup, include=F}
library(assertthat)
library(glue)
library(rsr)
library(scales)
library(dplyr)
library(ggplot2)
library(knitr)
library(svglite)

theme_538 = function(legend.pos="right"){
  theme(legend.title = element_blank(),
        legend.position = legend.pos,
        text = element_text(size=12)) 
}

myplot = function(ans,lbl){
  tb = ans |> count(short_label,answer) |> inner_join(lbl,by="short_label")
  ggplot(tb,aes(x=reorder(short_label,-project_ordering),y=n,fill=answer)) + 
    scale_fill_brewer("Cyl", palette = "Dark2") +
    coord_flip() + scale_y_continuous(expand=c(0,0)) +
    guides(fill=guide_legend(byrow = F)) +
    geom_col() +  xlab("") + ylab("") + 
    theme_538()
}

knitr::opts_chunk$set(collapse = TRUE,comment = "#>",dev = 'svg', fig.ext=".svg",
                      warning = F, message = F) 
```

Document reviews can eat a lot of time and often involve redundant work. Sysrev and rsr can help avoid duplicate work in document review.

This demo of reusability uses a sysrev of the parasitic disease [Echinococcosis](https://sysrev.com/p/111200) (ESR). ESR reviewed 31 articles and assigned values to 9 boolean labels. Sysrev provides a few methods for re-using the anaswers visualized below:

```{r dev='svg'}
ESR.pid = 111200 # ESR id is 111200

# get 31 articles, 279 answers & 9 lbls
ESR.art = get_articles(ESR.pid) 
ESR.ans = get_answers(ESR.pid)  
ESR.lbl = get_labels(ESR.pid)   
```

```{r lbl-barplot,fig.width=8, fig.height=2, out.width="90%", out.height="200em",fig.align='center', echo=F}
myplot(ESR.ans,ESR.lbl)
```

# Copy_answers
**Some methods require sysrev technical support**

ESR articles and labels can be copied into a new project through cloning, and previous answers can be assigned through `rsr::review` or `rsr::copy_answers`. Alternatively, articles and labels could be manually imported into a new project. See the video demo.

```{r clone-labels}
CPY = clone_sysrev(ESR.pid,"Clone ESR")

# get cloned lbls & articles
CPY.lbl = get_labels(CPY$pid)   
CPY.art = get_articles(CPY$pid)
```

**`article_data_id`** is a shared article id.

```{r eval=T}
CPY.art$article_data_id |> 
  setequal(ESR.art$article_data_id)
```

**`global_label_id`** is a shared label id.

```{r}
ESR.lbl$global_label_id |> 
  setequal(CPY.lbl$global_label_id)
```

`rsr::copy_answers` copies answers between projects with shared articles/labels. 

```{r eval=F}
rsr::copy_answers(ESR.pid,CPY$pid)
```

Plotting results shows a faithful duplication.

```{r lbl-barplot-2, fig.width=8, fig.height=2, out.width="90%", out.height="200em",fig.align='center', echo=F}
CPY.ans  = get_answers(CPY$pid)

tb  = ESR.ans |> count(short_label,answer) |> inner_join(ESR.lbl,by="short_label")
tb2 = CPY.ans |> count(short_label,answer) |> inner_join(CPY.lbl,by="short_label")
tb3 = rbind(tb |> mutate(sysrev="ESR"),tb2 |> mutate(sysrev="Clone ESR")) |> 
  select(sysrev,short_label,project_ordering,n,answer) |> 
  mutate(short_label = stringr::str_trunc(short_label,25,ellipsis = "â€¦"))

ggplot(tb3,aes(x=reorder(short_label,-project_ordering),y=n,fill=answer)) + 
  scale_fill_brewer("Cyl", palette = "Dark2") +
  coord_flip() + scale_y_continuous(expand=c(0,0)) +
  facet_grid(~sysrev) +
  guides(fill=guide_legend(byrow = F)) +
  geom_col() +  xlab("") + ylab("") + 
  theme_538()
```

# Video Demo



